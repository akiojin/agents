# 承認ワークフロー機能

## 概要

AGENTSプロジェクトに、実行計画の承認プロセスを対話的に行う機能を実装しました。
これにより、複雑度が中程度以上のタスクでは、ユーザーが計画を確認・承認してから実行されるようになります。

## 機能

### 1. 承認が必要な条件

- タスクの複雑度が「medium」または「high」の場合
- `approvalRequired`フラグがtrueに設定されている計画

### 2. 承認選択肢

ユーザーは以下の選択肢から選ぶことができます：

- **[A] 承認（Approve）**: 計画を承認して実行を開始
- **[R] 拒否（Reject）**: 計画を拒否して中止（理由の入力も可能）
- **[M] 修正（Modify）**: 計画を修正（現在未実装）
- **[D] 詳細（Details）**: 計画の詳細を表示

### 3. 表示される情報

#### 計画概要
- 計画ID
- タスク数
- 実行グループ数
- 推定実行時間
- 複雑度
- 主要タスクのリスト

#### 計画詳細（Dを選択時）
- 機能要件と非機能要件
- 実行グループの詳細（並列/順次実行）
- 各タスクの担当エージェント
- 依存関係
- 成功基準

### 4. 実行結果サマリー

実行完了後、以下の情報が表示されます：
- 成功/失敗のステータス
- タスクの成功数と失敗数
- 総実行時間

## 使用例

```typescript
// ワークフローオーケストレーターの使用
const orchestrator = WorkflowOrchestrator.getInstance();

// ユーザーリクエストの処理
const request: UserRequest = {
  id: 'req-001',
  description: 'ユーザー管理システムの作成',
  timestamp: new Date()
};

// processUserRequestメソッドが承認プロセスを自動的に処理
const result = await orchestrator.processUserRequest(request);
```

実行時の表示例：

```
============================================================
📋 実行計画の承認が必要です
============================================================

📊 計画概要:
  - 計画ID: plan-1234567890
  - タスク数: 5
  - 実行グループ数: 3
  - 推定実行時間: 30分
  - 複雑度: medium

📝 主要タスク:
  1. ユーザー認証機能の実装
  2. データベーススキーマの作成
  3. APIエンドポイントの実装
  4. フロントエンド画面の作成
  5. テストの作成と実行

選択肢:
  [A] 承認 - 計画を承認して実行
  [R] 拒否 - 計画を拒否して中止
  [M] 修正 - 計画を修正（未実装）
  [D] 詳細 - 計画の詳細を表示

選択してください [A/R/M/D]: 
```

## クラス構成

### ApprovalInterface

承認プロセスのUIを管理するクラス：

- `requestApproval(plan: ExecutionPlan)`: 承認を求める
- `displayExecutionSummary()`: 実行結果のサマリーを表示
- `close()`: インターフェースを閉じる

### WorkflowOrchestrator

既存のオーケストレーターに以下の変更を実装：

- `requestApproval()`: 対話的な承認プロセス
- `processUserRequest()`: 承認フローを統合

## テスト

`approval-interface.test.ts`でユニットテストを実装：

- 承認/拒否の選択テスト
- 詳細表示機能のテスト
- 無効入力時の再入力テスト
- 実行サマリー表示のテスト

## 今後の改善点

1. **修正機能の実装**: 計画を修正して再提案する機能
2. **承認履歴の保存**: 承認/拒否の履歴を記録
3. **タイムアウト機能**: 一定時間応答がない場合の処理
4. **Web UI対応**: ブラウザベースの承認インターフェース
5. **承認者の指定**: 特定のユーザーのみ承認可能にする機能